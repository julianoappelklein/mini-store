{"version":3,"file":"mini-store.browser.min.js","sources":["../src/index.ts","../src/browser-inject.ts"],"sourcesContent":["export interface SubscriberOptions<T, R> {\n  selector?: (state: T) => R;\n  comparer?: (a: R, b: R) => boolean;\n  emitOnSubscribe?: boolean;\n}\n\nexport interface UpdateOptions {\n  mode?: 'merge' | 'full';\n}\n\nexport interface Subscriber<T, R> {\n  selector: (state: T) => R;\n  lastValue: R;\n  callback: (newValue: R, prevValue: R | null) => void;\n  comparer: (a: R, b: R) => boolean;\n}\n\nexport class MiniStore<T = any> {\n  private _subscribers = new Set<Subscriber<T, any>>();\n  private _defaultComparer = <R>(a: R, b: R): boolean => a === b;\n  private _defaultSelector = <R>(state: T): R => state as unknown as R;\n  \n  public state: T;\n  public emitOnSubscribe: boolean = true;\n\n  constructor(state: T) {\n    this.state = state;\n  }\n\n  subscribe<R = T>(\n    callback: (newValue: R, prevValue: R | null) => void,\n    options: SubscriberOptions<T, R> = {}\n  ): () => void {\n    const { selector: argumentSelector, comparer: argumentComparer, emitOnSubscribe } = options;\n\n    const selector = argumentSelector ? (state: T): R => {\n      try {\n        return argumentSelector(state);\n      } catch (error) {\n        console.error('Error in selector:', error, state);\n        return null as R;\n      }\n    } : this._defaultSelector;\n\n    const comparer = argumentComparer ? (a: R, b: R): boolean => {\n      try {\n        return argumentComparer(a, b);\n      } catch (error) {\n        console.error('Error in comparer:', error, a, b);\n        return false; // treat as changed\n      }\n    } : this._defaultComparer;\n    \n    const subscriber: Subscriber<T, R> = {\n      selector,\n      lastValue: selector(this.state),\n      callback,\n      comparer\n    };\n    \n    this._subscribers.add(subscriber);\n    \n    if (emitOnSubscribe !== undefined ? emitOnSubscribe : this.emitOnSubscribe) {\n      callback(subscriber.lastValue, null);\n    }\n    \n    return () => {\n      this._subscribers.delete(subscriber);\n    };\n  }\n\n  update(stateOrFunction: Partial<T> | T | ((state: T) => T), options: UpdateOptions = {}): void {\n    console.log('Updating state:', stateOrFunction);\n    \n    const { mode = 'merge' } = options;\n    let newState: T;\n\n    if (typeof stateOrFunction === 'function') {\n      newState = (stateOrFunction as (state: T) => T)(this.state);\n    } else if (mode === 'merge') {\n      newState = { ...this.state as any, ...stateOrFunction as any } as T;\n    } else if (mode === 'full') {\n      newState = stateOrFunction as T;\n    } else {\n      throw new Error(`Unknown update mode: ${mode}`);\n    }\n\n    this.state = newState;\n\n    this._subscribers.forEach((subscriber) => {\n      try {\n        const prevValue = subscriber.lastValue;\n        const newValue = subscriber.selector(this.state);\n        const comparerResult = subscriber.comparer(prevValue, newValue);        \n        \n        if (!comparerResult) {\n          subscriber.lastValue = newValue;\n          subscriber.callback(newValue, prevValue);\n        }\n      } catch (err) {\n        console.error('Error in subscriber callback:', err);\n      }\n    });\n  }\n}\n\nexport default MiniStore;\n","import { MiniStore } from './index.js';\n\n// Inject MiniStore directly into the browser window object\ndeclare global {\n  interface Window {\n    MiniStore: typeof MiniStore;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.MiniStore = MiniStore;\n}\n\nexport { MiniStore };\n"],"names":[],"mappings":"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"}